# response_handler.py
from typing import Dict, Any, Optional
import re
from .prompts import SYSTEM_PROMPT

class ResponseHandler:
    def _handle_general_questions(self, user_query: str) -> Optional[str]:
        query_lower = user_query.lower()
        
        general_questions = {
            '–ø—Ä–∏–≤–µ—Ç': '–ü—Ä–∏–≤–µ—Ç! –Ø –≠–π—á–∞—Ä–∏–∫ - AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è HR –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ üí°\n\n–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
            'hello': 'Hello! I am HR Assistant - AI for HR analytics üí°\n\nHow can I help you?',
            'hi': 'Hi! I am HR Assistant üí°\n\nWhat would you like to know?',
            '—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å': self._get_capabilities_text(),
            '–ø–æ–º–æ—â—å': self._get_help_text(),
            '–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è': self._get_help_text(),
            '—Å–ø—Ä–∞–≤–∫–∞': self._get_help_text(),
            '–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏': self._get_capabilities_text(),
            'help': self._get_help_text(),
            'capabilities': self._get_capabilities_text(),
            '–∫–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã': self._get_help_examples(),
            '—á—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç—å': self._get_help_examples(),
            '–ø—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤': self._get_help_examples(),
        }
        
        for keyword, response in general_questions.items():
            if keyword in query_lower:
                return response
        
        return None

    def _handle_empty_response(self, category: str, user_query: str, command: Dict) -> str:
        templates = {
            "unknown_service": f"""üîç –ù–µ –Ω–∞—à–µ–ª –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É: "{user_query}"

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º:
‚Ä¢ –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –¢–∞–∫—Å–∏
‚Ä¢ –¢–µ–∫—É—á–µ—Å—Ç—å –≤ –ú–∞—Ä–∫–µ—Ç–µ
‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –û–±–ª–∞–∫—É

üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã: –¢–∞–∫—Å–∏, –ú–∞—Ä–∫–µ—Ç, –ö—Ä–∞—É–¥, –õ–∞–≤–∫–∞, –§–∏–Ω—Ç–µ—Ö, –ï–¥–∞, –î–æ—Å—Ç–∞–≤–∫–∞, –û–±–ª–∞–∫–æ""",
            
            "insufficient_risk_data": f"""üìä –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∏—Å–∫–æ–≤ –≤ —ç—Ç–æ–º –∑–∞–ø—Ä–æ—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö: "{user_query}"

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –≤ –¢–∞–∫—Å–∏
‚Ä¢ –ì—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –≤ –ú–∞—Ä–∫–µ—Ç–µ
‚Ä¢ –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã –ø–æ —Ç–µ–∫—É—á–µ—Å—Ç–∏

üí° –£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞""",
            
            "feature_unavailable": f"""üöß –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: "{user_query}"

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚Ä¢ –°—Ä–∞–≤–Ω–∏ —Ç–µ–∫—É—á–µ—Å—Ç—å –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º 
‚Ä¢ –¢–æ–ø –æ—Ç–¥–µ–ª–æ–≤ –ø–æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏
‚Ä¢ –î–∏–Ω–∞–º–∏–∫–∞ –Ω–∞–π–º–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–µ—Å—è—Ü—ã

üìà –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è""",
            
            "no_data_general": f"""üì≠ –ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö: "{user_query}"

–í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∏–ª—å—Ç—Ä—ã —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
‚Ä¢ –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –¢–∞–∫—Å–∏
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–Ω—â–∏–Ω –≤ –∫–æ–º–ø–∞–Ω–∏–∏
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É

üí¨ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã""",
            
            "missing_metric": f"""üéØ –ù–µ —É–∫–∞–∑–∞–Ω–∞ –º–µ—Ç—Ä–∏–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ: "{user_query}"

–£—Ç–æ—á–Ω–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å:
‚Ä¢ –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –¢–∞–∫—Å–∏
‚Ä¢ –¢–µ–∫—É—á–µ—Å—Ç—å –≤ –ú–∞—Ä–∫–µ—Ç–µ
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏

üìä –£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–µ—Ç—Ä–∏–∫—É""",
            
            "missing_column": f"""üìã –ù–µ —É–∫–∞–∑–∞–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ: "{user_query}"

–£—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ –∫–∞–∫–æ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—É –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É 
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –æ–ø—ã—Ç—É —Ä–∞–±–æ—Ç—ã

üóÇÔ∏è –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞""",
            
            "unknown_column": self._handle_unknown_query(user_query),
            "unsupported_method": self._handle_unknown_query(user_query),
            "unsupported_metric": self._handle_unknown_query(user_query),
            "other_error": self._handle_unknown_query(user_query)
        }
        return templates.get(category, self._handle_unknown_query(user_query))

    def _get_capabilities_text(self) -> str:
        return """üí° –ß—Ç–æ —è —É–º–µ—é:

üìä –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:
‚Ä¢ –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –¢–∞–∫—Å–∏
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–Ω—â–∏–Ω –∏ –º—É–∂—á–∏–Ω –≤ –∫–æ–º–ø–∞–Ω–∏–∏  
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É –∏ –≤–æ–∑—Ä–∞—Å—Ç—É

üí∞ –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞–≤–æ–∫ –∏ –æ–ø—ã—Ç–∞:
‚Ä¢ –î–æ–ª—è –ø–æ–ª–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ –≤ –∫–æ–º–ø–∞–Ω–∏–∏
‚Ä¢ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 10 –ª–µ—Ç
‚Ä¢ –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –ø–æ –æ—Ç–¥–µ–ª–∞–º

üë• –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
‚Ä¢ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –¥–æ 23 –ª–µ—Ç –≤ –¢–∞–∫—Å–∏
‚Ä¢ –ñ–µ–Ω—â–∏–Ω—ã —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 5 –ª–µ—Ç
‚Ä¢ –£–¥–∞–ª–µ–Ω—â–∏–∫–∏ –≤ –ö—Ä–∞—É–¥–µ

üìà –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:
‚Ä¢ –¢–æ–ø-5 —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏
‚Ä¢ –¢—Ä–µ–Ω–¥ –Ω–∞–π–º–æ–≤ –∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–π
‚Ä¢ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º"""

    def _get_help_text(self) -> str:
        return """üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã:

üî¢ –ë–∞–∑–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
‚Ä¢ –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –¢–∞–∫—Å–∏
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–Ω—â–∏–Ω –≤ –∫–æ–º–ø–∞–Ω–∏–∏
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É

üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
‚Ä¢ –¢–æ–ø-5 —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏  
‚Ä¢ –¢—Ä–µ–Ω–¥ –Ω–∞–π–º–æ–≤
‚Ä¢ –°—Ä–∞–≤–Ω–∏ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

üéØ –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
‚Ä¢ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –¥–æ 23 –ª–µ—Ç –≤ –¢–∞–∫—Å–∏
‚Ä¢ –ñ–µ–Ω—â–∏–Ω—ã —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 5 –ª–µ—Ç
‚Ä¢ –£–¥–∞–ª–µ–Ω—â–∏–∫–∏ –≤ –ö—Ä–∞—É–¥–µ

‚ö†Ô∏è –°–ª–æ–∂–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:
‚Ä¢ –°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –Ω–∞–Ω–∏–º–∞—Ç—å –≤ –¢–∞–∫—Å–∏?
‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –≤ –ú–∞—Ä–∫–µ—Ç–µ
‚Ä¢ –ì–¥–µ —Å–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Ç–µ–∫—É—á–µ—Å—Ç—å?"""

    def _get_help_examples(self) -> str:
        return """‚ùì –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:

üë• –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:
‚Ä¢ –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –¢–∞–∫—Å–∏
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–Ω—â–∏–Ω –≤ –∫–æ–º–ø–∞–Ω–∏–∏  
‚Ä¢ –°–∫–æ–ª—å–∫–æ —É–¥–∞–ª—ë–Ω—â–∏–∫–æ–≤ –≤ –∫–æ–º–ø–∞–Ω–∏–∏?

üìä –ü–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ:
‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –æ–ø—ã—Ç—É —Ä–∞–±–æ—Ç—ã  
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ –∫–æ–º–ø–∞–Ω–∏–∏

üèÜ –¢–æ–ø-–∑–∞–ø—Ä–æ—Å—ã:
‚Ä¢ –¢–æ–ø-5 —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏
‚Ä¢ –¢–æ–ø-10 –ª–æ–∫–∞—Ü–∏–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
‚Ä¢ –°–∞–º—ã–µ –∫—Ä—É–ø–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã

üìà –î–∏–Ω–∞–º–∏–∫–∞:
‚Ä¢ –¢—Ä–µ–Ω–¥ –Ω–∞–π–º–æ–≤
‚Ä¢ –£–≤–æ–ª—å–Ω–µ–Ω–∏—è –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º –ø–æ –º–µ—Å—è—Ü–∞–º
‚Ä¢ –°—Ä–∞–≤–Ω–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –ø–æ –ª–æ–∫–∞—Ü–∏—è–º

üéØ –°–ª–æ–∂–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
‚Ä¢ –°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –Ω–∞–Ω–∏–º–∞—Ç—å –≤ –¢–∞–∫—Å–∏?
‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –≤ –ú–∞—Ä–∫–µ—Ç–µ
‚Ä¢ –ì–¥–µ —Å–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Ç–µ–∫—É—á–µ—Å—Ç—å?"""

    def _handle_complex_query(self, user_query: str) -> str:
        return f"""ü§î –≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å: "{user_query}"

–°–µ–π—á–∞—Å —è —É–º–µ—é –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

üí∞ –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞–≤–æ–∫:
‚Ä¢ –î–æ–ª—è –ø–æ–ª–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ –≤ –∫–æ–º–ø–∞–Ω–∏–∏
‚Ä¢ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 10 –ª–µ—Ç
‚Ä¢ –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –ø–æ –æ—Ç–¥–µ–ª–∞–º

üë• –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—è:
‚Ä¢ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏ –æ–ø—ã—Ç—É
‚Ä¢ –ê–Ω–∞–ª–∏–∑ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤  
‚Ä¢ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

üìä –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:
‚Ä¢ –ü–æ–¥—Å—á–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –æ—Ç–¥–µ–ª–∞–º/—Å–µ—Ä–≤–∏—Å–∞–º
‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É, –æ–ø—ã—Ç—É, –ø–æ–ª—É  
‚Ä¢ –¢–æ–ø-20 —Å–ø–∏—Å–∫–∏ –ø–æ —Ä–∞–∑–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
‚Ä¢ –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Ç–µ–∫—É—á–µ—Å—Ç—å, –Ω–∞–π–º—ã)

–°–ª–æ–∂–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É (—Å—Ä–∞–≤–Ω–µ–Ω–∏—è, –ø—Ä–æ–≥–Ω–æ–∑—ã, –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑) –¥–æ–±–∞–≤–ª—é –≤ –±—É–¥—É—â–µ–º! üìà

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–æ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
‚Ä¢ "–°–∫–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ 0.5 —Å—Ç–∞–≤–∫–∏?"
‚Ä¢ "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞–≤–∫–∞–º"
‚Ä¢ "–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª—å—à–µ 2 –ª–µ—Ç"
‚Ä¢ "–ú–æ–ª–æ–¥—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –≤ –¢–∞–∫—Å–∏" """

    def _handle_unknown_query(self, user_query: str) -> str:
        return f"""–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –≤–æ–ø—Ä–æ—Å ü§î "{user_query}"

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:

üë• –ë–∞–∑–æ–≤—ã–µ:
‚Ä¢ –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –¢–∞–∫—Å–∏
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–Ω—â–∏–Ω –≤ –∫–æ–º–ø–∞–Ω–∏–∏
‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É

üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:  
‚Ä¢ –¢–æ–ø-5 —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏
‚Ä¢ –¢—Ä–µ–Ω–¥ –Ω–∞–π–º–æ–≤
‚Ä¢ –°—Ä–∞–≤–Ω–∏ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

üéØ –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–µ:
‚Ä¢ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –¥–æ 23 –ª–µ—Ç –≤ –¢–∞–∫—Å–∏
‚Ä¢ –ñ–µ–Ω—â–∏–Ω—ã —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 5 –ª–µ—Ç
‚Ä¢ –£–¥–∞–ª–µ–Ω—â–∏–∫–∏ –≤ –ö—Ä–∞—É–¥–µ

üí° –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ:
‚Ä¢ –ß—Ç–æ —Ç—ã —É–º–µ–µ—à—å?"""

    def _format_final_answer(self, user_query: str, tool_result: str, command: Dict[str, Any]) -> str:
        return tool_result